const express = require('express');
const axios = require('axios');
const { BSCSCAN_API_KEY } = require('../constants');
const { getCacheCustom, getCacheWithoutResponse } = require('../cache');
const { ttkHistoricalPrice } = require('../assets/TTK Historical Price');

const router = express.Router();

const contractaddress = '0x39703A67bAC0E39f9244d97f4c842D15Fbad9C1f';
const walletAddresses = [
  '0xb4376ffb81dc664e95ffcec13a35560f62a71b97',
  '0x7db5e589050fb135b07bFabd346da1aDADc1935d',
  '0x2ee1367f51b4381fea82dbf2729c2226de578084',
  '0xcab7125d94e3bced1a2712c4bdfabff290397776',
  '0x1Ba19d9Fd899571374b6A7E2a4775A8aC6E4347f',
  '0x8673BD388d45634cC4ae077a09dfCa0B993ebbBe',
  '0xfFb7e46a0bb394260a0624a78f1556b19ec662a9',
  '0xfA87388bcfa21D0200de1c847675613247D4b811',
  '0x33Ef48ee50Fa0aC72e4C5f4FbccAf21c1Ed4480F',
  '0x0Dc71D8cCa1ceB0FCCD37d6aa8ef7F2E514aB769',
  '0x033937CfA296C63Cb59C252945794aa47eFB203c',
  '0xfA63a86BAB6633eA468F2ed0f1A83882dA655749',
  '0x421ecdEb005e3a290385bA08E2209300aBA07a41',
  '0xAa555D2ABc3e4985D460fcDfAe2CC027d2772Aa2',
  '0xe1993A889fD3faa292d2c32b75E9C0236619f191',
  '0x4C4dDE0ECee5a91EE0833159C7496BEb6856cbAB',
  '0x322e9313fBA28Fa9B21b0532b92B49077F107070',
  '0xFC373bC0eEcc789093A83B52B0b85395Fd4E7951',
  '0xe3eC7693802131A37a446B9d9Cc3801BEc10a0Cc',
  '0xd999074F947f9813bDD161Fb2452332ac6a4D695',
  '0xb73f8AbC0371b1AB67f9dAAEdb7eCBc1b1dD7e79',
  '0xb73f8AbC0371b1AB67f9dAAEdb7eCBc1b1dD7e79',
  '0x860798ea8cCbf1E9ade6103050A5f6F6927Fe972',
  '0x4a5BB1c9347A0d4F7e06a29239162f03647d9232',
  '0x2762606F365275D6698b31edaf2D4B846d930592',
  '0xD4EE91079678173012092718710Cc8ACf3128c5c',
  '0x31FE783A8b82C4a69E9dCcFCa6876923215028A6',
  '0xB0Fe72AC8C235B9D9d15D207fbc8e04E4310f425',
  '0x2d221700bbC02f03D23A2C186d41A2835accB76E',
  '0xd33619B122B27f712AA5F784BC54DE9c95c7588d',
  '0x9538E4935E3426e57000b8091fcC0C4DB305B256',
  '0x6E29077cc9d807e53077CE807e680338c33E5Cf2',
  '0xA636A0c0457E8AC1f05030fd88f61e0e8484a4a3',
  '0xe942f66850111662399d6d39b05e4206B7d79fE6',
  '0xD517E00351f8Bb88f66632939523eb54Ea29CCE4',
  '0x66b0F5b9f302d4D312A88f422E848cdeA3b8d973',
  '0x28FfE8f3906C937199360a0493C863168E088915',
  '0xf20465b541c15145D2f6E3e5DD7Bed9c5cA63Ad5',
  '0x1aaB39ad0b4FD8c75E6e728Abd9365BbBfd2F49A',
  '0x0BD3Caa6A2BaE9A83b12113eFb32FcCbA58bacc9',
  '0xd7A9c1b328CfD3CF00bCDe4FE9b4118c49bB27d0',
  '0x507Cf5196F4f030D57e1ce34aB1DB0b476Cac9fC',
  '0xcF5A5C531BB08441c56AD71369a2536e3c7c85fD',
  '0x3830119cb52E7A3Ade67f0DCDbF68AE757f0382f',
  '0xdF17c6402312Dfae82bCAFbaE0F3b1A14905202f',
  '0x069E2B8915D8f452d0BF1Bd6FF648758496d2533',
  '0x32AccAEfa35620b51c061901AFf1B74991E7322b',
  '0x4646D4D2E25e981bb85369e92FaEF648201A320C',
  '0x33142B70d290cAe2fE4d0Bbc1B116F5032F80fA5',
  '0xED5D43ADfA92eBC745d5De9b286065af81649F40',
  '0x9779C2850B376B5386f2fA531f745eeA31B8c683',
  '0x68CCd45A40218d4D13569A5e2FfA24aE8AbEe7be',
  '0xA2E23b948a41B271D5a7563e61F8B2990Cb4Cb65',
  '0x0199A805209A29859315B20844e0da4F20d931C1',
  '0x54143C1e28b2F54A77eA8FD046A939E3eA808d0a',
  '0x7bbf3eD7531cC73E6eD48401Bb77854b129b89EE',
  '0xFB9deb5b6C488Fe61e1A8A482c5cEF1A583321d2',
  '0xCA63CD425d0e78fFE05a84c330Bfee691242113d',
  '0x82Ba7508f7F1995AB1623258D66Cb4E2B2b8F467',
  '0xAe3E9Cf3a1b39C27f8cCa96AFEbBdDEa6C0e0B56',
  '0x50899582199c06d5264edDCD12879E5210783Ba8',
  '0x2dDC842CE54866d6FF58F5f82C6FB838e6A74cd3',
  '0xba7552fF8E3debC95b5D7CdB60e950B437b53316',
  '0x61C98F7110DdcE29680CD7EB6E1cd77a81D7587A',
  '0x776d07E36d9f3C75952470CAfB33e80846F9d267',
  '0x61eee1d22d3ca1df312cafcc084e7d32f707fae9',
  '0x6cDAcd9cD2d4A824BCe5E91F4899c959F2693a9f',
  '0x91406b5d57893e307f042d71c91e223a7058eb72',
  '0x41E3FE77DE1EcA115902eB058b1FB57395358d62',
  '0xB1515eAb5e715B268413FB418bbAD4f6e4650DaF',
  '0xfb4334A5704e29DF37efc9F16255759670018D9A',
  '0x252378Dd762da1EB778e1a3B6683f5457184ac98',
  '0x2938b2a7EbF9a59645E39d51ec5eCA2869D6C53D',
  '0x9fe553de68865F425d8071C81640855A7C9613eb',
  '0x4bA5Ca72C0d647eF13c7c6903199BD3dB7Bc6f9f',
  '0xb0A45b17f87B12e5A6Ad460e4F5aD543388BF365',
  '0xaC6dE9f16c7b9B44C4e5C9073C3a10fA45aB4d5a',
  '0x61DC46CeF15DCf3031594645968dfEF2c9aF3d5C',
  '0x4553ed5d8d3731e629f67bd86abd021175f31848',
  '0xA49AC2c25d202893F331C8e9b1c13DcC702Ce9E3',
  '0x68e788Fa690307D5a994191Daadc2dd0507BCC4F',
  '0x22cFaEAD8d65822a55C9222d6C18Bb91d2f69EBA',
  '0xEfF15199c294d9BCf792c18A09242dBbAAe7Fc56',
  '0x612665B4C9fE3dcc516c5E990338936D0590f67E',
  '0x3EA8C3E47A0C26cac208A6Df9BAf34E847f8077F',
  '0x86B337Be60C942e80f31e7Be097De1cA821c5f7F',
  '0x96F89B37334dBA99b867ab812C1bbDf2E2103D23',
  '0x287F5FEC1a4f982898E8764245E428F868D4e758',
  '0x4910198F711b06953B91F5665Be6EB6B2d39c5A9',
  '0x1Aa62E8aBC31270DEf8C548379B04E4ed47546D7',
  '0x2d0032BF2cB2434A4f5EbC222565976B04551469',
  // '0x5Cbc816bB51d8B46e9DefAeB4bEbe70F3899af59',
].filter((value, index, self) => self.indexOf(value) == index)

// Get TTK token transactions
router.get('/txlist', (req, res) => {
  const {  startblock, endblock, page, offset, sort } = req.query;
  const params = {
    module: 'ttk',
    action: 'txlist',
    apikey: BSCSCAN_API_KEY,
  };
  getCacheCustom(res, params, async (client) => {
    const data = {};
    for (const address of walletAddresses) {
      const internalParams = {
        module: 'account',
        action: 'tokentx',
        apikey: BSCSCAN_API_KEY,
        address,
        contractaddress,
        startblock,
        endblock,
        page,
        offset,
        sort
      };
      const response = await getCacheWithoutResponse(internalParams)
      data[address] = response.result;
      await new Promise((resolve) => setTimeout(() => {
        resolve()
      }, 300))
    }
    client.setex(JSON.stringify(params), 60, JSON.stringify(data))
    res.json(data)
  });
});

router.get('/historicalPrice', (req, res) => {
  res.json(ttkHistoricalPrice)
})

module.exports = router;